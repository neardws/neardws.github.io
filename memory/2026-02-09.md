## MinerU WebUI 多用户并发版本部署

### 完成工作
1. **诊断问题**：原 `app.py` 单线程阻塞，多用户同时操作会卡住
2. **开发新版本**：创建 `app_async.py` 支持异步并发 + 任务队列
3. **数据库升级**：添加 `task_id`、`progress`、`user_id` 字段
4. **用户隔离**：基于IP哈希实现多用户数据隔离
5. **部署上线**：切换至新版本，服务运行在 http://192.168.31.211:7860

### 新版本特性
- 最大并发：2个任务同时解析（防止Mac Mini过载）
- 任务队列：超出并发限制自动排队，显示队列位置
- 实时状态：pending → uploading → parsing → downloading → completed
- 取消功能：排队中的任务可取消
- **用户隔离**：每个用户只能看到自己的历史记录（基于IP哈希）
- 历史记录：SQLite持久化，刷新页面不丢失

### 技术实现
- asyncio + ThreadPoolExecutor 处理后台任务
- 自定义 TaskQueueManager 单例管理队列
- Gradio 界面 + 状态刷新按钮
- **用户识别**：`gr.Request` 获取客户端IP，哈希生成用户ID
- **数据隔离**：数据库查询按 `user_id` 过滤
- SSH/SCP 与 Mac Mini 通信保持不变

### 测试状态
- 单用户基础功能：✅ 正常
- 多用户并发测试：待验证
- 队列排队逻辑：待验证
- 用户隔离功能：✅ 已部署

### 文件位置
- 代码：`/home/neardws/mineru-webui/app_async.py`
- 数据：`/home/neardws/mineru-webui/storage/history.db`
- 日志：`/tmp/mineru_async.log`

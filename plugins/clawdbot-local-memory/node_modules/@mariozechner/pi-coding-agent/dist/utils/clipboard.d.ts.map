{"version":3,"file":"clipboard.d.ts","sourceRoot":"","sources":["../../src/utils/clipboard.ts"],"names":[],"mappings":"AAIA,wBAAgB,eAAe,CAAC,IAAI,EAAE,MAAM,GAAG,IAAI,CAgDlD","sourcesContent":["import { execSync, spawn } from \"child_process\";\nimport { platform } from \"os\";\nimport { isWaylandSession } from \"./clipboard-image.js\";\n\nexport function copyToClipboard(text: string): void {\n\tconst p = platform();\n\tconst options = { input: text, timeout: 5000 };\n\n\ttry {\n\t\tif (p === \"darwin\") {\n\t\t\texecSync(\"pbcopy\", options);\n\t\t} else if (p === \"win32\") {\n\t\t\texecSync(\"clip\", options);\n\t\t} else {\n\t\t\t// Linux - try wl-copy for Wayland, fall back to xclip/xsel for X11\n\t\t\tconst isWayland = isWaylandSession();\n\t\t\tif (isWayland) {\n\t\t\t\ttry {\n\t\t\t\t\t// Verify wl-copy exists (spawn errors are async and won't be caught)\n\t\t\t\t\texecSync(\"which wl-copy\", { stdio: \"ignore\" });\n\t\t\t\t\t// wl-copy with execSync hangs due to fork behavior; use spawn instead\n\t\t\t\t\tconst proc = spawn(\"wl-copy\", [], { stdio: [\"pipe\", \"ignore\", \"ignore\"] });\n\t\t\t\t\tproc.stdin.on(\"error\", () => {\n\t\t\t\t\t\t// Ignore EPIPE errors if wl-copy exits early\n\t\t\t\t\t});\n\t\t\t\t\tproc.stdin.write(text);\n\t\t\t\t\tproc.stdin.end();\n\t\t\t\t\tproc.unref();\n\t\t\t\t} catch {\n\t\t\t\t\t// Fall back to xclip/xsel (works on XWayland)\n\t\t\t\t\ttry {\n\t\t\t\t\t\texecSync(\"xclip -selection clipboard\", options);\n\t\t\t\t\t} catch {\n\t\t\t\t\t\texecSync(\"xsel --clipboard --input\", options);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttry {\n\t\t\t\t\texecSync(\"xclip -selection clipboard\", options);\n\t\t\t\t} catch {\n\t\t\t\t\texecSync(\"xsel --clipboard --input\", options);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (error) {\n\t\tconst msg = error instanceof Error ? error.message : String(error);\n\t\tif (p === \"linux\") {\n\t\t\tconst tools = isWaylandSession() ? \"wl-copy, xclip, or xsel\" : \"xclip or xsel\";\n\t\t\tthrow new Error(`Failed to copy to clipboard. Install ${tools}: ${msg}`);\n\t\t}\n\t\tthrow new Error(`Failed to copy to clipboard: ${msg}`);\n\t}\n}\n"]}